name: Send Meeting Reminders

on:
  schedule:
    # every Monday at 1:00 AM
    - cron: '0 1 * * 1'
  workflow_dispatch: {}

jobs:
  send-reminders:
    runs-on: ubuntu-latest
    steps:
      - name: Call send-reminders endpoint
        env:
          REMINDERS_URL: ${{ secrets.REMINDERS_URL }}
          CRON_SECRET: ${{ secrets.CRON_SECRET }}
        run: |
          if [ -z "$REMINDERS_URL" ]; then
            echo "ERROR: set repository secret REMINDERS_URL to the public URL of your app (e.g. https://example.com/api/meetings/send-reminders)" >&2
            exit 1
          fi

          if [ -z "$CRON_SECRET" ]; then
            echo "ERROR: set repository secret CRON_SECRET to match your deployment's CRON_SECRET env var" >&2
            exit 1
          fi

          echo "Calling $REMINDERS_URL"
          curl -sSf -X GET "$REMINDERS_URL" -H "x-cron-secret: $CRON_SECRET" -o /tmp/send-reminders.json || (cat /tmp/send-reminders.json || true; exit 1)
          echo "Response:"
          cat /tmp/send-reminders.json
